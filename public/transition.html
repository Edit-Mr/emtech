<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Transition to fixed position with CSS and JavaScript</title>
        <style>
            body {
                height: 200vh;
            }
            input {
                margin-top: 70vh;
                width: 5rem;
                height: 5rem;
            }
            #box {
                margin-top: 0vh;
            }
            .box {
                width: 200px;
                height: 200px;
                background-color: dodgerblue;
                position: relative;
            }
            #box-fixed {
                position: fixed;
                background-color: darkorchid;
                display: none;
                transform: translate(-50%, -50%);
            }
            .smooth {
                transition: all 2s ease;
            }
            /* Centered state */
            .centered {
                top: 50% !important;
                left: 50% !important;
            }

            /* Disable scroll */
            body.no-scroll {
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <h1>Transition to fixed position with CSS and JavaScript</h1>
        <div class="box" id="box"></div>
        <div class="box" id="box-fixed"></div>
        <input type="checkbox" name="" id="check" checked="false" /> Click Me
        <script>
            const checkbox = document.getElementById("check");
            const box = document.getElementById("box");
            const fixedBox = document.getElementById("box-fixed");

            checkbox.addEventListener("change", (e) => {
                // Disable scrolling
                document.body.classList.add("no-scroll");

                // Get the position and size of the box
                const rect = box.getBoundingClientRect();
                // match the size and position of the original box
                fixedBox.classList.remove("smooth");
                fixedBox.style.width = `${rect.width}px`;
                fixedBox.style.height = `${rect.height}px`;
                // display and hide original box
                box.style.visibility = "hidden";
                fixedBox.style.display = "block";
                if (e.target.checked) {
                    fixedBox.style.top = `${rect.top + rect.height / 2}px`;
                    fixedBox.style.left = `${rect.left + rect.width / 2}px`;
                    fixedBox.classList.add("smooth");
                    // Animate to center
                    setTimeout(() => {
                        fixedBox.classList.add("centered");
                    }, 10); // Slight delay to allow the transition to work

                    // After the animation, re-enable scrolling
                    setTimeout(() => {
                        document.body.classList.remove("no-scroll");
                    }, 2000); // Match the duration of the animation (0.3s)
                } else {
                    fixedBox.classList.add("smooth");
                    fixedBox.classList.remove("centered");
                    fixedBox.style.left = `${rect.left + rect.width / 2}px`;
                    // scroll to the element position
                    // calc the top offset if box compare to the top of the body
                    const topOffset =
                        rect.top + window.scrollY - window.innerHeight / 2;
                    console.log(topOffset);
                    if (topOffset < 0) {
                        fixedBox.style.top = `${
                            rect.top + rect.height / 2 + window.scrollY
                        }px`;
                        window.scrollTo({
                            top: 0,
                            behavior: "smooth"
                        });
                    } else {
                        fixedBox.style.top = `${window.innerHeight / 2}px`;
                        window.scrollTo({
                            top: topOffset,
                            behavior: "smooth"
                        });
                    }
                    // After the animation, re-enable scrolling
                    setTimeout(() => {
                        document.body.classList.remove("no-scroll");
                        box.style.visibility = "visible";
                        fixedBox.style.display = "none";
                    }, 2000); // Match the duration of the animation (0.3s)
                }
            });
        </script>
    </body>
</html>
